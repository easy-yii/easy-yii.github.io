<!DOCTYPE html>
<html lang="zh-CN">

<!-- Head tag -->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <!--Description-->
  
  <meta name="description" content="hacking-with-yii2">
  

  <!--Author-->
  
  <meta name="author" content="缘莲度">
  

  <!--Open Graph Title-->
  
      <meta property="og:title" content="model-1"/>
  
  <!--Open Graph Description-->
  
      <meta property="og:description" content="hacking-with-yii2" />
  
  <!--Open Graph Site Name-->
  <meta property="og:site_name" content="hacking-with-yii2"/>
  <!--Type page-->
  
      <meta property="og:type" content="article" />
  
  <!--Page Cover-->
  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- Title -->
  
  <title>model-1 - hacking-with-yii2</title>


  <link rel="shortcut icon" href="https://static.hinpc.com/image/2016/20160807-hi-logo.png">

  <!-- Custom CSS/Sass -->
  <link rel="stylesheet" href="/css/style.css">

  <!----------------------------
  https://github.com/GallenHu/hexo-theme-Daily

 _____            _   _
|  __ \          (_) | |
| |  | |   __ _   _  | |  _   _
| |  | |  / _` | | | | | | | | |
| |__| | | (_| | | | | | | |_| |
|_____/   \__,_| |_| |_|  \__, |
                          __/ |
                         |___/

    --------------------------->

</head>


<body>

  <!-- Nav -->
  <header class="site-header">
  <div class="header-inside">
    <div class="logo">
      <a href="/" rel="home">
        
        <img src="https://avatars3.githubusercontent.com/u/23000895?v=3&s=200" alt="hacking-with-yii2" height="60">
        
      </a>
    </div>
    <!-- Navigation -->
    <nav class="navbar">
      <!-- Collect the nav links, forms, and other content for toggling -->
      <div class="collapse">
        <ul class="navbar-nav">
          
          
            <li>
              <a href="/.">
                
                  Home
                
              </a>
            </li>
          
            <li>
              <a href="/archives">
                
                  Archive
                
              </a>
            </li>
          
            <li>
              <a href="/about">
                
                  About
                
              </a>
            </li>
          
        </ul>
      </div>
      <!-- /.navbar-collapse -->
    </nav>
    <div class="button-wrap">
      <button class="menu-toggle">Primary Menu</button>
    </div>
  </div>
</header>


  <!-- Main Content -->
  <div class="content-area">
  <div class="post">
    <!-- Post Content -->
    <div class="container">
      <article>
        <!-- Title date & tags -->
        <div class="post-header">
          <h1 class="entry-title">
            model-1
            
          </h1>
          <p class="posted-on">
          2016-12-06
          </p>
          <div class="tags-links">
            
              
            
          </div>
        </div>
        <!-- Post Main Content -->
        <div class="entry-content">
          <h2 id="前言"><a class="header-anchor" href="#前言">¶</a>前言</h2>
<p>MVC设计模式是一个经典的设计模式。大多数框架都已mvc为基本架构。Model主要负责处理数据，可以理解为与数据库打交道。
Controller，主要处理view传来的请求，向model请求数据，并将请求的数据传给view。View,主要将用户所需的请求传给控制器、接收controller传来的数据，并在页面内渲染。
按照本人的理解，M负责数据，C负责业务逻辑，V负责页面交互。</p>
<p>这一节内容，通过一个简单的场景(博客)来主要梳理yii2框架的模型，重点说CURD操作(即create、update、read、delete)和关联模型，并会简单的说下控制器。</p>
<p>本文依旧先梳理思路，掌握整体结构，再一个个梳理知识点，建议结合文档看，list部分重点列举了用法，部分解释不清楚的参考文档。</p>
<ul>
<li><a href="http://www.yiichina.com/doc/guide/2.0/db-query-builder" target="_blank" rel="external">查询构建器</a></li>
<li><a href="http://www.yiichina.com/doc/guide/2.0/db-active-record" target="_blank" rel="external">活动纪录</a></li>
</ul>
<h2 id="one-steps"><a class="header-anchor" href="#one-steps">¶</a>One:Steps</h2>
<h3 id="场景"><a class="header-anchor" href="#场景">¶</a>场景</h3>
<p>一个博客需要作者和文章内容。作者可以在后台管理自己的文章内容(增删改查)，用户可以在前台看到作者的文章和并对文章评论。</p>
<h3 id="step-one-tables"><a class="header-anchor" href="#step-one-tables">¶</a>step one tables</h3>
<p>简单的分析以下需求，我们建立的数据库如下。大家可利用上一节学习的内容，使用迁移来建立自己的数据库。记得修改相关数据库配置。</p>
<p><strong>用户表user</strong></p>
<table>
<thead>
<tr>
<th>Columns</th>
<th>Type</th>
<th>Length</th>
<th>Allow Null</th>
<th>Default</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>用户id</td>
</tr>
<tr>
<td>username</td>
<td>varchar</td>
<td>255</td>
<td>no</td>
<td></td>
<td>用户名</td>
</tr>
<tr>
<td>password</td>
<td>varchar</td>
<td>255</td>
<td>no</td>
<td></td>
<td>密码</td>
</tr>
<tr>
<td>group</td>
<td>int</td>
<td>3</td>
<td>no</td>
<td>1</td>
<td>分组</td>
</tr>
<tr>
<td>email</td>
<td>varchar</td>
<td>255</td>
<td>no</td>
<td></td>
<td>邮箱</td>
</tr>
<tr>
<td>created_at</td>
<td>bigint</td>
<td>20</td>
<td>no</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updated_at</td>
<td>bigint</td>
<td>20</td>
<td>yes</td>
<td></td>
<td>更新时间</td>
</tr>
</tbody>
</table>
<p><strong>文章表post</strong></p>
<table>
<thead>
<tr>
<th>Columns</th>
<th>Type</th>
<th>Length</th>
<th>Allow Nul</th>
<th>Default</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>文章id</td>
</tr>
<tr>
<td>author_id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>作者id</td>
</tr>
<tr>
<td>title</td>
<td>varchar</td>
<td>255</td>
<td>no</td>
<td></td>
<td>文章标题</td>
</tr>
<tr>
<td>body</td>
<td>text</td>
<td></td>
<td>no</td>
<td></td>
<td>文章内容</td>
</tr>
<tr>
<td>created_at</td>
<td>bigint</td>
<td>20</td>
<td>no</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updated_at</td>
<td>bigint</td>
<td>20</td>
<td>yes</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>deleted_at</td>
<td>bigint</td>
<td>20</td>
<td>yes</td>
<td></td>
<td>删除时间</td>
</tr>
</tbody>
</table>
<p><strong>评论表comment</strong></p>
<table>
<thead>
<tr>
<th>Columns</th>
<th>Type</th>
<th>Length</th>
<th>Allow Nul</th>
<th>Default</th>
<th>Comment</th>
</tr>
</thead>
<tbody>
<tr>
<td>id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>评论id</td>
</tr>
<tr>
<td>title_id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>评论的文章id</td>
</tr>
<tr>
<td>user_id</td>
<td>int</td>
<td>11</td>
<td>no</td>
<td></td>
<td>用户id</td>
</tr>
<tr>
<td>content</td>
<td>text</td>
<td></td>
<td>no</td>
<td></td>
<td>内容</td>
</tr>
<tr>
<td>created_at</td>
<td>bigint</td>
<td>20</td>
<td>no</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updated_at</td>
<td>bigint</td>
<td>20</td>
<td>yes</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>deleted_at</td>
<td>bigint</td>
<td>20</td>
<td>yes</td>
<td></td>
<td>删除时间</td>
</tr>
</tbody>
</table>
<h3 id="steps-two-建立model"><a class="header-anchor" href="#steps-two-建立model">¶</a>steps two 建立model</h3>
<p>yii有很多类型的model，我们简单的了解下。</p>
<p><code>yii\base\Model</code>,是基本模型,一般情况下会用来处理用户模型操作。它有很多子类。
比如<code>yii\db\ActiveRecord</code>,这也是我们经常用的高级模型类，进行相关数据库操作，当然它也具备<code>yii\base\Model</code>所有功能。大多数情况我们主要使用此高级模型类。</p>
<p>想了解更多，可以点击连接。<a href="http://www.yiiframework.com/doc-2.0/yii-base-model.html" target="_blank" rel="external">yii\base\Model-api</a></p>
<p><code>bankend</code>和<code>frontend</code>都可以继承<code>common\models\Post.php</code>，并把公共部分代码放置于这个文件。具体代码如下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">common</span>\<span class="title">models</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">behaviors</span>\<span class="title">TimestampBehavior</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">ActiveRecord</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line"><span class="comment">//关联表名</span></div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">tableName</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="string">'post'</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="comment">//事件，创建更新，可自动对时间赋值，默认字段是，created_at updated_at</span></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">behaviors</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> [</div><div class="line">			TimestampBehavior::className(),</div><div class="line">		];</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>backend\models\Post</code>继承<code>common\models\Post</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">backend</span>\<span class="title">models</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Yii</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">common</span>\<span class="title">models</span>\<span class="title">Post</span> <span class="title">as</span> <span class="title">BasePost</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">BasePost</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">rules</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> [</div><div class="line">			[[<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>], <span class="string">'required'</span>],</div><div class="line">		];</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		$post = Yii::$app-&gt;request-&gt;post();<span class="comment">//获取post请求传来的参数</span></div><div class="line">		<span class="keyword">$this</span>-&gt;load([<span class="string">'Post'</span> =&gt; $post]);<span class="comment">//通过load为字段赋值</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@return</span> bool</div><div class="line">	 * 创建一篇文章</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">postCreate</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="comment">//$post = new self();</span></div><div class="line">		<span class="comment">//$post-&gt;author_id = $post['author_id'];</span></div><div class="line">		<span class="comment">//$post-&gt;title = $post['title'];</span></div><div class="line">		<span class="comment">//$post-&gt;body = $post['body'];</span></div><div class="line">		<span class="keyword">return</span> <span class="keyword">$this</span>-&gt;save();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> $id</div><div class="line">	 * <span class="doctag">@return</span> bool</div><div class="line">	 * 更新某篇文章</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">postUpdate</span><span class="params">($id)</span></span></div><div class="line">	&#123;</div><div class="line"></div><div class="line">		$post = <span class="keyword">self</span>::findPostById($id);</div><div class="line">		<span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;attributes <span class="keyword">as</span> $key =&gt; $value) &#123;</div><div class="line">			$post-&gt;$key = $value ? :$post-&gt;$key;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">return</span> $post-&gt;save();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> $id</div><div class="line">	 * <span class="doctag">@return</span> bool</div><div class="line">	 * 删除某篇文章</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">postDelete</span><span class="params">($id)</span></span></div><div class="line">	&#123;</div><div class="line">		$post = <span class="keyword">self</span>::findPostById($id);</div><div class="line">		<span class="comment">//$post-&gt;delete();</span></div><div class="line">		$post-&gt;deleted_at = time();</div><div class="line">		<span class="keyword">return</span> $post-&gt;save();</div><div class="line"> 	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@param</span> $id</div><div class="line">	 * <span class="doctag">@return</span> static</div><div class="line">	 * 根据id返回某篇文章</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">findPostById</span><span class="params">($id)</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> Post::findOne([<span class="string">'id'</span> =&gt; $id]);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * <span class="doctag">@return</span> array|\yii\db\ActiveRecord[]</div><div class="line">	 * 返回未删除的文章并倒序排列</div><div class="line">	 */</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">postList</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">self</span>::find()-&gt;where([<span class="string">'deleted_at'</span>=&gt;<span class="keyword">null</span>])-&gt;orderBy(<span class="string">'id desc'</span>)-&gt;asArray()-&gt;all();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="steps-three-建立controller"><a class="header-anchor" href="#steps-three-建立controller">¶</a>steps three 建立controller</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by PhpStorm.</div><div class="line"> * User: yuan</div><div class="line"> * Date: 16/10/31</div><div class="line"> * Time: 14:54</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">namespace</span> <span class="title">backend</span>\<span class="title">controllers</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Yii</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">base</span>\<span class="title">Controller</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">backend</span>\<span class="title">models</span>\<span class="title">Post</span>;</div><div class="line"><span class="keyword">use</span> <span class="title">yii</span>\<span class="title">db</span>\<span class="title">Query</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostController</span> <span class="keyword">extends</span> <span class="title">Controller</span></span></div><div class="line">&#123;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionIndex</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		var_dump(Post::postList());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionView</span><span class="params">()</span> </span>&#123;</div><div class="line">		$id = Yii::$app-&gt;request-&gt;get(<span class="string">'id'</span>);</div><div class="line">		var_dump(Post::findPostById($id)-&gt;attributes);<span class="keyword">die</span>();</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionCreate</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		$post = <span class="keyword">new</span> Post();</div><div class="line">		var_dump($post-&gt;postCreate());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionUpdate</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">		$id = Yii::$app-&gt;request-&gt;get(<span class="string">'id'</span>);</div><div class="line">		$post = <span class="keyword">new</span> Post();</div><div class="line">		var_dump($post-&gt;postUpdate($id));</div><div class="line">	&#125;</div><div class="line"></div><div class="line"></div><div class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actionDelete</span><span class="params">()</span></span></div><div class="line">	&#123;</div><div class="line">        $id =  Yii::$app-&gt;request-&gt;get(<span class="string">'id'</span>);</div><div class="line">        var_dump(Post::postDelete($id));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="steps-four-调试"><a class="header-anchor" href="#steps-four-调试">¶</a>steps four 调试</h3>
<p>调试工具推荐:Postman</p>
<p>测试之前，我们美化一下url，在<code>common\config\main.php</code>中，加入下面一段代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&apos;components&apos; =&gt; [</div><div class="line">    &apos;urlManager&apos; =&gt; [</div><div class="line">	    &apos;enablePrettyUrl&apos; =&gt; true,</div><div class="line">	    &apos;showScriptName&apos; =&gt; false,</div><div class="line">	    &apos;suffix&apos;=&gt;&apos;.html&apos;,</div><div class="line">	    &apos;rules&apos; =&gt; [</div><div class="line">		    &apos;static/download/&lt;type&gt;/&lt;filename&gt;&apos; =&gt; &apos;static/download&apos;</div><div class="line">	    ],</div><div class="line">    ],</div><div class="line">   ],</div></pre></td></tr></table></figure>
<p>测试路由示例：</p>
<ul>
<li>路由：<code>yii-blog.backend.com/post/create.html</code>；方法<code>post</code>;传入参数：<code>author_id</code>,<code>title</code>,<code>body</code>;返回：<code>true</code>或者<code>false</code>;</li>
<li>路由：<code>yii-blog.backend.com/post/index.html</code>；方法<code>get</code>;传入参数：;返回：一个数组;</li>
</ul>
<h3 id="steps-five-练习"><a class="header-anchor" href="#steps-five-练习">¶</a>steps five 练习</h3>
<p>大家可依照post，完成comment和user相关代码。</p>
<h2 id="two-list"><a class="header-anchor" href="#two-list">¶</a>Two: List</h2>
<h3 id="关联表"><a class="header-anchor" href="#关联表">¶</a>关联表</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//一对多关联</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Customer</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrders</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="comment">// 客户和订单通过 Order.customer_id -&gt; id 关联建立一对多关系</span></div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Order::className(), [<span class="string">'customer_id'</span> =&gt; <span class="string">'id'</span>]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 一对一关联</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span></span></div><div class="line">&#123;</div><div class="line">    <span class="comment">// 订单和客户通过 Customer.id -&gt; customer_id 关联建立一对一关系</span></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getCustomer</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasOne(Customer::className(), [<span class="string">'id'</span> =&gt; <span class="string">'customer_id'</span>]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//中间表关联 如果 order 表和 item 表通过中间表 order_item 关联起来</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getItems</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Item::className(), [<span class="string">'id'</span> =&gt; <span class="string">'item_id'</span>])</div><div class="line">            -&gt;viaTable(<span class="string">'order_item'</span>, [<span class="string">'order_id'</span> =&gt; <span class="string">'id'</span>]);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">或</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> <span class="keyword">extends</span> \<span class="title">yii</span>\<span class="title">db</span>\<span class="title">ActiveRecord</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getOrderItems</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(OrderItem::className(), [<span class="string">'order_id'</span> =&gt; <span class="string">'id'</span>]);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getItems</span><span class="params">()</span></span></div><div class="line">    &#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;hasMany(Item::className(), [<span class="string">'id'</span> =&gt; <span class="string">'item_id'</span>])</div><div class="line">            -&gt;via(<span class="string">'orderItems'</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="create"><a class="header-anchor" href="#create">¶</a>create</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$post = <span class="keyword">new</span> Post();</div><div class="line">$post-&gt;title = <span class="string">'title one'</span>;</div><div class="line">$post-&gt;body = <span class="string">'body'</span>;</div><div class="line">$post-&gt;save();</div></pre></td></tr></table></figure>
<h3 id="update"><a class="header-anchor" href="#update">¶</a>update</h3>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::findOne($id);</div><div class="line">$post-&gt;title = <span class="string">'title change'</span>;</div><div class="line">$post-&gt;save(); <span class="comment">//或$post-&gt;update();</span></div></pre></td></tr></table></figure>
<h3 id="delete"><a class="header-anchor" href="#delete">¶</a>delete</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$post = Post::findOne($id);</div><div class="line">$post-&gt;delete();</div></pre></td></tr></table></figure>
<h3 id="find"><a class="header-anchor" href="#find">¶</a>find</h3>
<ul>
<li>返回所有数据<code>$post = Post::find()-&gt;all();</code></li>
<li>返回一条author_id的数据：<code>$post = Post::find()-&gt;where(['author_id'=&gt;1])-&gt;one();</code></li>
<li>计算author_id为1的纪录条数总和：<code>$post = Post::find()-&gt;where(['author_id'=&gt;1])-&gt;count();</code></li>
<li>以author_id为索引结果集，出现多条author_id相同的只会保留其中一条纪录返回：<code>$post = Post::find()-&gt;indexBy('author_id')-&gt;all();</code></li>
<li>用原生sql检索：<code>$sql = 'select * from post';$post = Post::findBySql($sql)-&gt;asArray()-&gt;all();</code></li>
<li>用原生sql检索：<code>$sql = 'select * from post';$post = Post::findBySql($sql)-&gt;asArray()-&gt;one();</code></li>
<li>返回一条id为1的纪录：<code>$post = Post::findOne(1);</code></li>
<li>返回一条id为1且author_id为1的纪录：<code>$post = Post::findOne(['id'=&gt;1,'author_id'=&gt;1]);</code></li>
<li>返回id为1、2、3的所有纪录，不能与<code>asArray()</code>组合：<code>$post = Post::findAll([1,2,3]);</code></li>
<li>返回author_id为1的所有纪录，不能与<code>asArray()</code>组合：<code>$post = Post::findAll(['author_id'=&gt;1]);</code></li>
</ul>
<h4 id="select"><a class="header-anchor" href="#select">¶</a>select</h4>
<ul>
<li>返回所有纪录，但只返回id、author_id、title、bod字段：<code>$post = Post::find()-&gt;select(['id','author_id', 'title', 'body'])-&gt;asArray()-&gt;all();</code></li>
<li>指定别名: id指定别名post_id,<code>$post = Post::find()-&gt;select(['id AS post_id','author_id', 'title', 'body'])-&gt;asArray()-&gt;all();</code></li>
<li>addSelect: 用法同<code>select</code></li>
</ul>
<h4 id="asarray"><a class="header-anchor" href="#asarray">¶</a>asArray</h4>
<p>以数组形式返回：
<code>$post = Post::find()-&gt;select(['id','author_id', 'title', 'body'])-&gt;asArray()-&gt;all();</code></p>
<h4 id="distinct"><a class="header-anchor" href="#distinct">¶</a>distinct</h4>
<p>以数组形式返回所有的author_id，并去除重复的author_id：<code>$post = Post::find()-&gt;select('author_id')-&gt;distinct()-&gt;asArray()-&gt;all()</code></p>
<h4 id="where"><a class="header-anchor" href="#where">¶</a>where</h4>
<p>操作where的三种格式：</p>
<ul>
<li>字符串格式，例如：‘status=1’:
<ul>
<li><code>$post = Post::find()-&gt;select(['id','author_id', 'title', 'body'])-&gt;where('author_id = 1')-&gt;asArray()-&gt;all();</code></li>
<li><code>$post = Post::find()-&gt;select(['id','author_id', 'title', 'body'])-&gt;where('author_id = :user_id',[':user_id'=&gt;1])-&gt;asArray()-&gt;all();</code></li>
</ul>
</li>
<li>哈希格式，例如： [‘status’ =&gt; 1, ‘type’ =&gt; 2]: <code>$post = Post::find()-&gt;select(['id','author_id', 'title', 'body'])-&gt;where(['author_id'=&gt;1,'title'=&gt;'title1'])-&gt;asArray()-&gt;all();</code></li>
<li>操作符格式，例如：[‘like’, ‘name’, ‘test’]，如下：</li>
</ul>
<p><strong>and</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'and'</span>, <span class="string">'author_id=1'</span>, [<span class="string">'or'</span>, <span class="string">"title='title1'"</span>, <span class="string">"title='title3'"</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>or</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'or'</span>, <span class="string">"title='title1'"</span>, <span class="string">"title='title3'"</span>])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>between</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'between'</span>,<span class="string">'author_id'</span>,<span class="number">1</span>,<span class="number">8</span>])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>not between</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'not between'</span>,<span class="string">'author_id'</span>,<span class="number">1</span>,<span class="number">8</span>])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>in</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'in'</span>,<span class="string">'id'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div><div class="line">或</div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'id'</span> =&gt; [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>not in</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'not in'</span>,<span class="string">'id'</span>,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>like</strong>:模糊查询</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回字段body中有`body`和`update`的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'like'</span>,<span class="string">'body'</span>,[<span class="string">'body'</span>,<span class="string">'update'</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div><div class="line">			</div><div class="line">或</div><div class="line"></div><div class="line"><span class="comment">//返回字段body中有`body`的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'like'</span>,<span class="string">'body'</span>,<span class="string">'body'</span>,])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>or like</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//返回字段title有`1`或`2`的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'or like'</span>,<span class="string">'title'</span>,[<span class="string">'1'</span>,<span class="string">'3'</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>not like</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//不要返回字段title有`1`或`2`的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'not like'</span>,<span class="string">'title'</span>,[<span class="string">'1'</span>,<span class="string">'2'</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>or not like</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//不要返回字段title中有9和title的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'or not like'</span>,<span class="string">'title'</span>,[<span class="string">'9'</span>,<span class="string">'title'</span>]])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>&gt;,&gt;=,&lt;,&lt;=</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//author_id小于3的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'&lt;'</span>,<span class="string">'author_id'</span>,<span class="number">3</span>])</div><div class="line">			-&gt;asArray()-&gt;all();</div><div class="line"></div><div class="line"><span class="comment">//author_id大于等于3的所有纪录</span></div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where([<span class="string">'&gt;='</span>,<span class="string">'author_id'</span>,<span class="number">3</span>])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>exists</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//如果存在author_id 为2的数据，返回所有的纪录</span></div><div class="line">$query = Post::find()-&gt;where([<span class="string">'author_id'</span>=&gt;<span class="number">2</span>]);</div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where( [<span class="string">'exists'</span>,$query])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>not exists</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//如果不存在author_id 为2的数据，返回所有的纪录</span></div><div class="line">$query = Post::find()-&gt;where([<span class="string">'author_id'</span>=&gt;<span class="number">2</span>]);</div><div class="line">$post = Post::find()-&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>, <span class="string">'title'</span>, <span class="string">'body'</span>])</div><div class="line">			-&gt;where( [<span class="string">'exists'</span>,$query])</div><div class="line">			-&gt;asArray()-&gt;all();</div></pre></td></tr></table></figure>
<h4 id="orderby-排序"><a class="header-anchor" href="#orderby-排序">¶</a>orderBy:排序</h4>
<p><code>$post = Post::find()-&gt;orderBy(['id' =&gt; SORT_ASC, 'author_id' =&gt; SORT_DESC,])-&gt;all();</code>
<code>$post = Post::find()-&gt;orderBy('id ASC, author_id DESC')-&gt;all();</code>
<code>$post = Post::find()-&gt;orderBy('id ASC')-&gt;addOrderBy('author_id DESC')-&gt;all();</code></p>
<h4 id="having"><a class="header-anchor" href="#having">¶</a>having</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//查找body字段中有update的纪录，并计算所有该作者的文章总和</span></div><div class="line">$post = Post::find()</div><div class="line">		    -&gt;select([<span class="string">'COUNT(*) AS count'</span>,<span class="string">'author_id'</span>,<span class="string">'body'</span>])</div><div class="line">			-&gt;having([<span class="string">'like'</span>,<span class="string">'body'</span>,<span class="string">'update'</span>])</div><div class="line">			-&gt;groupBy(<span class="string">'author_id'</span>)</div><div class="line">			-&gt;asArray()</div><div class="line">			-&gt;all();</div></pre></td></tr></table></figure>
<h4 id="groupby"><a class="header-anchor" href="#groupby">¶</a>groupBy</h4>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//按照author_id分组并计算每组总和,只打印计数总和、author_id</span></div><div class="line">$post = Post::find()</div><div class="line">		    -&gt;select([<span class="string">'COUNT(*) AS count'</span>,<span class="string">'author_id'</span>])</div><div class="line">			-&gt;groupBy(<span class="string">'author_id'</span>)</div><div class="line">			-&gt;asArray()</div><div class="line">			-&gt;all();</div></pre></td></tr></table></figure>
<p><code>$post = Post::find()-&gt;groupBy('author_id')-&gt;asArray()-&gt;all();</code></p>
<p>判断id为2的纪录是否存在，存在返回true，不存在返回false：
<code>$post = Post::find()-&gt;where( [ 'id' =&gt; 2 ] )-&gt;exists();</code></p>
<h4 id="addxxx"><a class="header-anchor" href="#addxxx">¶</a>addXXX()</h4>
<p>addXXX()，这种写法，一般作为条件补充。用法不多说，同上。</p>
<ul>
<li>addHaving()</li>
<li>addSelect()</li>
<li>addParams()</li>
<li>addOrderBy()</li>
<li>addGroupBy()</li>
</ul>
<h4 id="filterwhere"><a class="header-anchor" href="#filterwhere">¶</a>filterWhere</h4>
<p>过滤用户输入的空值,比如用户登陆时输入的用户名或者email，如果值为空，则默认不作为查询条件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">User::find()-&gt;filterWhere([</div><div class="line">    <span class="string">'username'</span> =&gt; $username,</div><div class="line">    <span class="string">'email'</span> =&gt; $email,		</div><div class="line">]);</div></pre></td></tr></table></figure>
<h4 id="andfiltercompare-column-name-value-defaultoperator"><a class="header-anchor" href="#andfiltercompare-column-name-value-defaultoperator">¶</a>andFilterCompare(‘column_name’,‘value’,’$defaultOperator = ‘=’ ')</h4>
<p>为特定列添加过滤条件，并允许用户选择过滤器运算符.如<code>&lt;</code>,<code>&gt;</code>,<code>&gt;=</code>,<code>&lt;=</code>,<code>&lt;&gt;</code>,<code>=</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()</div><div class="line">	-&gt;andFilterCompare(<span class="string">'author_id'</span>,<span class="string">'4'</span>,<span class="string">'&lt;'</span>)</div><div class="line">	-&gt;asArray()</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<h4 id="limit-offset"><a class="header-anchor" href="#limit-offset">¶</a>limit  offset</h4>
<p>limit 限制返回的条数，可以用空值或者负值禁用。</p>
<p>offset 比如返回10条数据，偏移量为3，则会返回后面7条数据.</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$post = Post::find()</div><div class="line">    -&gt;select([<span class="string">'id'</span>,<span class="string">'author_id'</span>,<span class="string">'body'</span>])</div><div class="line">	-&gt;andFilterCompare(<span class="string">'author_id'</span>,<span class="string">'4'</span>,<span class="string">'&lt;'</span>)</div><div class="line">	-&gt;limit(<span class="number">3</span>)</div><div class="line">	-&gt;offset(<span class="number">2</span>)</div><div class="line">	-&gt;asArray()</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<h3 id="join"><a class="header-anchor" href="#join">¶</a>join</h3>
<p><strong>join()</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//第一个参数，可为'left join' ,'right join','inner join'</span></div><div class="line">$post = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'post'</span>)</div><div class="line">    -&gt;join(<span class="string">'right join'</span>,<span class="string">'user'</span>,<span class="string">'user.id = post.author_id '</span>)</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>innerJoin()</strong></p>
<p><code>post</code> 为左表，<code>user</code>为右表。只有当左表和右表有对应的数据时，才会显示这条数据。比如，<code>post</code>必须有<code>author_id=1</code>且<code>user</code>有<code>id＝1</code>的数据，才会返回。</p>
<p><strong>leftJoin()</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'post'</span>)</div><div class="line">	-&gt;innerJoin(<span class="string">'user'</span>,<span class="string">'user.id = post.author_id '</span>)</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<p><code>post</code> 为左表，<code>user</code>为右表。会以左表为中心，即<code>post</code>，会全部加载左表的内容，如果右表没有匹配项，则右表相应字段值显示为null。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'post'</span>)</div><div class="line">	-&gt;leftJoin(<span class="string">'user'</span>,<span class="string">'user.id = post.author_id '</span>)</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>rightJoin()</strong></p>
<p><code>post</code> 为左表，<code>user</code>为右表。会以右表为中心，即<code>user</code>，会全部加载右表的内容，如果左表没有匹配项，则左表相应字段值显示为null。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$post = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'post'</span>)</div><div class="line">	-&gt;rightJoin(<span class="string">'user'</span>,<span class="string">'user.id = post.author_id '</span>)</div><div class="line">	-&gt;all();</div></pre></td></tr></table></figure>
<p><strong>union()</strong></p>
<p>UNION 常用于<strong>数据类似</strong>的两张或多张表查询，如不同的数据分类表，或者是数据历史表等。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$query_one = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'post'</span>)</div><div class="line">    -&gt;andFilterCompare(<span class="string">'author_id'</span>,<span class="string">'4'</span>,<span class="string">'&lt;='</span>);</div><div class="line"></div><div class="line">$query_two = (<span class="keyword">new</span> Query())-&gt;from(<span class="string">'user'</span>)</div><div class="line">    -&gt;where([<span class="string">'id'</span>=&gt;<span class="number">1</span>]);</div><div class="line">var_dump($query_two-&gt;union($query_one)-&gt;all());</div><div class="line">		</div><div class="line"><span class="comment">//打印的结构是user表的结构，大家可以尝试一下，如果两张表结构差距很大，结果会很有趣</span></div></pre></td></tr></table></figure>
<h3 id="批处理"><a class="header-anchor" href="#批处理">¶</a>批处理</h3>
<p><code>yii\db\Query::all()</code>会把所有数据全部读出来，放到内存中。所以需要处理大数据时，不太适合。为了保持较低的内存占有，使用<code>batch</code>和<code>each</code>。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//each</span></div><div class="line">$post = Post::find();</div><div class="line"><span class="keyword">foreach</span>($post-&gt;each() <span class="keyword">as</span> $key=&gt;$value) &#123;</div><div class="line">	var_dump($value-&gt;author_id);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//batch</span></div><div class="line">$post = Post::find();</div><div class="line"><span class="keyword">foreach</span>($post-&gt;batch() <span class="keyword">as</span> $posts) &#123;</div><div class="line">    <span class="comment">//posts是一个包含100条或小于100条数据的数组</span></div><div class="line">	<span class="keyword">foreach</span>($posts <span class="keyword">as</span> $key =&gt; $value) &#123;</div><div class="line">	var_dump($value-&gt;author_id);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>后记，
后续内容：</p>
</blockquote>
<ul>
<li>load()</li>
<li>rules</li>
<li>scenario</li>
<li>validate</li>
</ul>
<p>如有问题可通过以下方式联系我：</p>
<ul>
<li>可直接留言，我每天都会看的</li>
<li><a href="https://github.com/easy-yii/easy-yii.github.io/issues" target="_blank" rel="external">点击此处创建issue</a></li>
<li>也可邮箱联系我，yuanliandu@qq.com</li>
</ul>

        </div>
      </article>
    </div>
    <!-- Comments -->
    <div class="container">
      
<section id="comment">
  <!-- <h1 class="title">留言</h1> -->

  
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-model-1" data-title="model-1" data-url="http://easy-yii.github.io/2016/12/06/model-1/"></div>
    <!-- 多说评论框 end -->
  
</section>

    </div>
    <!-- Pre or Next -->
    <div class="nav-links">
      
      
        <div class="nav-next">
          <a href="/2016/12/06/migrations/" rel="prev">下一页 <span class="meta-arraw meta-arraw-right"></span></a>
        </div>
      
    </div>

  </div>
</div>


  <!-- Footer -->
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<!-- Footer-widgets -->
<div class="footer-widgets">
	<div class="row inside-wrapper">
		<div class="col-1-3">
			<aside>
				<h1 class="widget-title">关于本站</h1>

				<div class="custom-widget-content">
					
					<p align="left">一步一个脚印，细致地学习Yii2，从实践到阅读源码。</p>
				</div>
			</aside>
		</div>
		<div class="col-1-3">
			<aside>
				<h1 class="widget-title">与我联系</h1>

				<div class="widget-text">
					
					
					<a href="https://github.com/YuanLianDu" class="icon icon-github" target="_blank">github</a>
					
					<a href="mailto:yuanliandu@qq.com" class="icon icon-mail" target="_blank">mail</a>
					
					
				</div>
			</aside>
		</div>
		<div class="col-1-3">
			<aside>
				<h1 class="widget-title">站内搜索</h1>

				<div class="widget-text">
					<form onSubmit="return appDaily.submitSearch('')">
						<p>
							<input type="text" placeholder="search..." id="homeSearchInput">
						</p>
						<!--<input type="submit" value="GO">-->
					</form>
				</div>
			</aside>
		</div>
		<div style="margin-right: 220px">
			<span id="busuanzi_container_site_pv">
				本站总访问量<span id="busuanzi_value_site_pv"></span>次
			</span>
			<span id="busuanzi_container_site_uv">
                本站访客数<span id="busuanzi_value_site_uv"></span>人次
			</span>
		</div>
	</div>
</div>


<!-- Footer -->
<footer class="site-info">
	<p>
		<span>hacking-with-yii2 &copy; 2016</span>
		
		<span class="split">|</span><span>Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> with Theme <a href="https://github.com/GallenHu/hexo-theme-Daily" target="_blank">Daily</a></span>
		
	</p>
</footer>


  <!-- After footer scripts -->
  <!-- scripts -->
<script src="//cdn.bootcss.com/zepto/1.2.0/zepto.min.js"></script>
<script src="/js/app.js"></script>

  <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'easy-yii'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0]
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->



</body>

</html>